services:
  nfq_sylius_omnisend_plugin.form.extension.type.channel:
    class: NFQ\SyliusOmnisendPlugin\Form\Extension\ChannelFormTypeExtension
    tags:
      - { name: form.type_extension, extended_type: Sylius\Bundle\ChannelBundle\Form\Type\ChannelType }

  nfq_sylius_omnisend_plugin.resolver.product_image:
    class: NFQ\SyliusOmnisendPlugin\Resolver\ProductImageResolver
    arguments:
      - '@liip_imagine.cache.manager'
      - '%nfq_sylius_omnisend_plugin.product_image.type%'
      - '%nfq_sylius_omnisend_plugin.product_image.filter%'
      - '%nfq_sylius_omnisend_plugin.product_image.default_image%'

  nfq_sylius_omnisend_plugin.builder.product_picker:
    class: NFQ\SyliusOmnisendPlugin\Builder\ProductPickerBuilder
    arguments:
      - '@nfq_sylius_omnisend_plugin.resolver.product_image'
      - '@sylius.calculator.product_variant_price'
      - '@sylius.context.channel.composite'
      - '@router'

  nfq_sylius_omnisend_plugin.builder.product_picker_director:
    class: NFQ\SyliusOmnisendPlugin\Builder\ProductPickerBuilderDirector
    arguments:
      - '@sylius.product_variant_resolver.default'
      - '@nfq_sylius_omnisend_plugin.builder.product_picker'

  nfq_sylius_omnisend_plugin.twig.product_picker_extension:
    class: NFQ\SyliusOmnisendPlugin\Twig\ProductPickerExtension
    arguments:
      - '@nfq_sylius_omnisend_plugin.builder.product_picker_director'
      - '@serializer'
    tags:
      - { name: twig.extension }

  nfq_sylius_omnisend_plugin.product_picker_object_normalizer:
    public: true
    class: Symfony\Component\Serializer\Normalizer\ObjectNormalizer
    autoconfigure: false
    calls:
      - ['setSerializer', ['@serializer']]
    autowire: false
    arguments:
      - '@serializer.mapping.class_metadata_factory'
      - '@nfq_sylius_omnisend_plugin.serializer.name_converter.product_picker'
      - ~
      - '@property_info.reflection_extractor'

  nfq_sylius_omnisend_plugin.serializer.name_converter.product_picker:
    class: NFQ\SyliusOmnisendPlugin\Serializer\NameConverter\ProductPickerNameConverter

  nfq_sylius_omnisend_plugin.serializer.normalizer.product_picker:
    class: NFQ\SyliusOmnisendPlugin\Serializer\Normalizer\ProductPickerNormalizer
    arguments:
      - '@nfq_sylius_omnisend_plugin.product_picker_object_normalizer'
    tags:
      - { name: 'serializer.normalizer' }
